"use strict";exports.id=486,exports.ids=[486],exports.modules={486:(e,t,a)=>{a.d(t,{m:()=>P});var i=a(326),s=a(7577),n=a(76),l=a(445),o=a(1664),r=a(3682),d=a(4690),c=a(5047),m=a(1223);let p=s.forwardRef(({className:e,...t},a)=>i.jsx("div",{className:"relative w-full overflow-auto",children:i.jsx("table",{ref:a,className:(0,m.cn)("w-full caption-bottom text-sm",e),...t})}));p.displayName="Table";let x=s.forwardRef(({className:e,...t},a)=>i.jsx("thead",{ref:a,className:(0,m.cn)("[&_tr]:border-b",e),...t}));x.displayName="TableHeader";let h=s.forwardRef(({className:e,...t},a)=>i.jsx("tbody",{ref:a,className:(0,m.cn)("[&_tr:last-child]:border-0",e),...t}));h.displayName="TableBody",s.forwardRef(({className:e,...t},a)=>i.jsx("tfoot",{ref:a,className:(0,m.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...t})).displayName="TableFooter";let u=s.forwardRef(({className:e,...t},a)=>i.jsx("tr",{ref:a,className:(0,m.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...t}));u.displayName="TableRow";let y=s.forwardRef(({className:e,...t},a)=>i.jsx("th",{ref:a,className:(0,m.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...t}));y.displayName="TableHead";let j=s.forwardRef(({className:e,...t},a)=>i.jsx("td",{ref:a,className:(0,m.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...t}));j.displayName="TableCell",s.forwardRef(({className:e,...t},a)=>i.jsx("caption",{ref:a,className:(0,m.cn)("mt-4 text-sm text-muted-foreground",e),...t})).displayName="TableCaption";var f=a(8091),g=a(9508),N=a(2714),w=a(5956),b=a(948);let D=b.zt,v=b.fC,C=b.xz,A=s.forwardRef(({className:e,sideOffset:t=4,...a},s)=>i.jsx(b.VY,{ref:s,sideOffset:t,className:(0,m.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...a}));function I({complaints:e,onEdit:t,onDelete:a,onHistory:n,currentUser:l}){let r=(0,s.useMemo)(()=>{if(!l)return{canEditAny:!1,canDeleteAny:!1,isEffectivelyViewer:!0};let e=l.role,t=!1,a=!1;return"admin"===e?(t=!0,a=!0):"special_editor_priority"===e||"updater"===e?(t=!0,a=!1):"creator"===e&&(t=!0,a=!1),{canEditAny:t,canDeleteAny:a}},[l]);return l?e&&0!==e.length?i.jsx(D,{children:i.jsx("div",{className:"rounded-lg border shadow-sm bg-white",children:(0,i.jsxs)(p,{className:"w-full",children:[(0,i.jsxs)("colgroup",{children:[i.jsx("col",{style:{width:"60px"}}),i.jsx("col",{style:{width:"100px"}}),i.jsx("col",{style:{width:"120px"}}),i.jsx("col",{style:{width:"140px"}}),i.jsx("col",{style:{minWidth:"250px"}}),i.jsx("col",{style:{width:"90px"}}),i.jsx("col",{style:{width:"110px"}}),i.jsx("col",{style:{width:"200px"}}),i.jsx("col",{style:{width:"160px"}}),i.jsx("col",{style:{width:"120px"}}),i.jsx("col",{style:{minWidth:"200px"}}),i.jsx("col",{style:{width:"90px"}}),i.jsx("col",{style:{width:"120px"}}),i.jsx("col",{style:{width:"120px"}}),i.jsx("col",{style:{width:"120px"}}),i.jsx("col",{style:{width:"120px"}}),i.jsx("col",{style:{width:"80px"}}),i.jsx("col",{style:{width:"120px"}})]}),i.jsx(x,{children:(0,i.jsxs)(u,{children:[i.jsx(y,{className:"w-[60px] pl-[20px]",children:"Sl No"}),i.jsx(y,{className:"w-[100px]",children:"Complaint ID"}),i.jsx(y,{className:"w-[120px]",children:"C. Date"}),i.jsx(y,{className:"w-[140px]",children:"Machine Name"}),i.jsx(y,{className:"min-w-[250px]",children:"Description"}),i.jsx(y,{className:"w-[90px]",children:"Priority"}),i.jsx(y,{className:"w-[110px]",children:"Status"}),i.jsx(y,{className:"w-[200px]",children:"Created By (Email)"}),i.jsx(y,{className:"w-[160px]",children:"Concerned Department"}),i.jsx(y,{className:"w-[120px]",children:"A. Date"}),i.jsx(y,{className:"min-w-[200px]",children:"Remarks"}),i.jsx(y,{className:"w-[90px]",children:"Assigned To"}),i.jsx(y,{className:"w-[120px]",children:"In-I. Date"}),i.jsx(y,{className:"w-[120px]",children:"In-E. Date"}),i.jsx(y,{className:"w-[120px]",children:"F. Date"}),i.jsx(y,{className:"text-center w-[120px]",children:"History"}),i.jsx(y,{className:"text-center w-[80px]",children:"Delete"}),i.jsx(y,{className:"text-right w-[120px]",children:"Actions"})]})}),i.jsx(h,{children:e.map((e,s)=>{let d=!1;if(l){let e=l.role;"admin"===e?d=!0:"creator"===e?d=!1:"updater"===e?d=!0:"special_editor_priority"===e&&(d=!0)}return(0,i.jsxs)(u,{className:"align-middle text-sm whitespace-nowrap",children:[i.jsx(j,{className:"font-mono text-xs text-muted-foreground py-3 pl-[20px]",children:String(s+1).padStart(2,"0")}),i.jsx(j,{className:"font-mono text-xs font-bold py-3",children:e.complaintId&&""!==e.complaintId.trim()&&void 0!==e.complaintId?e.complaintId:e.id?e.id.slice(-2).padStart(2,"0"):"N/A"}),i.jsx(j,{children:e.complaintDate&&!isNaN(new Date(e.complaintDate).getTime())?(0,w.WU)(new Date(e.complaintDate),"dd-MM-yy"):"N/A"}),i.jsx(j,{className:"font-medium",children:e.machineName}),i.jsx(j,{children:(0,i.jsxs)(v,{children:[i.jsx(C,{asChild:!0,children:i.jsx("p",{className:"truncate max-w-[250px] hover:underline cursor-pointer",children:e.complaintDescription})}),i.jsx(A,{side:"top",align:"start",className:"max-w-xs bg-popover text-popover-foreground p-2 rounded shadow-lg border",children:i.jsx("p",{className:"text-sm",children:e.complaintDescription})})]})}),i.jsx(j,{children:i.jsx("span",{className:"High"===e.priority?"priority-badge-high":"Medium"===e.priority?"priority-badge-medium":"priority-badge-low",children:e.priority})}),i.jsx(j,{children:i.jsx("span",{className:"Open"===e.complaintStatus?"status-badge-open":"Closed"===e.complaintStatus?"status-badge-closed":"status-badge-inprogress",children:e.complaintStatus})}),i.jsx(j,{className:"font-mono text-xs",children:e.createdBy||"N/A"}),i.jsx(j,{style:{minWidth:180,fontWeight:600},children:e.department&&""!==e.department?e.department:"N/A"}),i.jsx(j,{children:e.actionDate&&!isNaN(new Date(e.actionDate).getTime())?(0,w.WU)(new Date(e.actionDate),"dd-MM-yy"):"N/A"}),i.jsx(j,{children:e.maintenanceRemarks||"N/A"}),i.jsx(j,{children:(0,i.jsxs)("select",{value:e.assignedTo||"Person A",onChange:e=>{},style:{width:"100%",padding:4,borderRadius:4,border:"1px solid #1976d2",color:"#1976d2",background:"#e3f0ff",fontWeight:600,minWidth:160},children:[i.jsx("option",{value:"Person A",children:"Person A"}),i.jsx("option",{value:"Person B",children:"Person B"}),i.jsx("option",{value:"Person C",children:"Person C"}),i.jsx("option",{value:"Person D",children:"Person D"})]})}),i.jsx(j,{children:e.initialInspectionDate&&!isNaN(new Date(e.initialInspectionDate).getTime())?(0,w.WU)(new Date(e.initialInspectionDate),"dd-MM-yy"):"N/A"}),i.jsx(j,{children:e.estimatedEndDate&&!isNaN(new Date(e.estimatedEndDate).getTime())?(0,w.WU)(new Date(e.estimatedEndDate),"dd-MM-yy"):"N/A"}),i.jsx(j,{children:e.finalizationDate&&!isNaN(new Date(e.finalizationDate).getTime())?(0,w.WU)(new Date(e.finalizationDate),"dd-MM-yy"):"N/A"}),i.jsx(j,{className:"text-center",children:i.jsx(o.z,{variant:"outline",size:"sm",onClick:()=>n(e),"aria-label":"Complaint History",className:"text-blue-600 border-blue-400 hover:bg-blue-50",children:"History"})}),i.jsx(j,{className:"text-center",children:r.canDeleteAny&&i.jsx(o.z,{variant:"ghost",size:"sm",onClick:()=>a(e),className:"text-destructive hover:text-destructive/80","aria-label":"Delete Complaint",children:i.jsx(f.Z,{className:"h-4 w-4"})})}),i.jsx(j,{className:"text-right",children:i.jsx(o.z,{variant:"ghost",size:"sm",onClick:()=>t(e),"aria-label":d&&r.canEditAny?"Edit Complaint":"View Complaint",children:d&&r.canEditAny?i.jsx(g.Z,{className:"h-4 w-4"}):i.jsx(N.Z,{className:"h-4 w-4"})})})]},e.id)})})]})})}):i.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No complaints found."}):i.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Please log in to view complaints."})}A.displayName=b.VY.displayName;let z=({open:e,onClose:t,complaint:a})=>e?a?i.jsx("div",{style:{zIndex:9999,position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"rgba(0,0,0,0.3)",display:e?"flex":"none",alignItems:"center",justifyContent:"center"},children:(0,i.jsxs)("div",{style:{background:"linear-gradient(135deg, #e3f0ff 0%, #90caf9 100%)",borderRadius:12,minWidth:400,minHeight:200,padding:28,boxShadow:"0 0 24px #0004",position:"relative",border:"2px solid #1976d2"},children:[i.jsx("button",{onClick:t,style:{position:"absolute",top:8,right:12,fontWeight:700,fontSize:22,background:"#1976d2",color:"white",border:"none",borderRadius:"50%",width:32,height:32,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"background 0.2s",boxShadow:"0 2px 8px #1976d233"},title:"Close",children:"\xd7"}),i.jsx("h2",{style:{fontWeight:700,fontSize:20,marginBottom:12,color:"#1976d2"},children:"Complaint History"}),Array.isArray(a.history)&&a.history.length>0?i.jsx("ul",{style:{margin:0,padding:0,listStyle:"none"},children:a.history.map((e,t)=>{let a="";return a="Created"===e.action?"Created by ":"Updated"===e.action?"Updated by ":`${e.action} by `,(0,i.jsxs)("li",{style:{marginBottom:8,display:"flex",alignItems:"center",gap:12},children:[i.jsx("span",{style:{color:"#333",fontWeight:500},children:a}),i.jsx("a",{href:`mailto:${e.user}`,style:{color:"#1976d2",textDecoration:"underline",fontWeight:500},children:e.user}),i.jsx("span",{style:{color:"#c2185b",fontWeight:600},children:new Date(e.timestamp).toLocaleString("en-GB",{day:"numeric",month:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",second:"2-digit",hour12:!0})})]},t)})}):(0,i.jsxs)("div",{style:{color:"red",fontWeight:600},children:["No history available.",i.jsx("br",{})]})]})}):(0,i.jsxs)("div",{style:{padding:24,color:"red",fontWeight:600},children:["No complaint selected.",i.jsx("br",{})]}):null;function P({initialComplaints:e=[]}){let{currentUser:t}=(0,d.a)(),[a,m]=(0,s.useState)(e),[p,x]=(0,s.useState)(!1),[h,u]=(0,s.useState)(null),y=(0,c.useRouter)();(0,s.useMemo)(()=>null,[""]);let j=async()=>{if(console.log("[ComplaintsClientPage] fetchComplaints: currentUser",t),t)try{let e;e="admin"===t.role||"maintenance"===t.role?(0,n.hJ)(l.db,"complaints"):(0,n.IO)((0,n.hJ)(l.db,"complaints"),(0,n.ar)("createdBy","==",t.email));let a=await (0,n.PL)(e),i=["Open","In Progress","Closed","Pending Parts"],s=a.docs.map(e=>{let t=e.data(),a=i.includes(t.complaintStatus)?t.complaintStatus:"Open";return{id:e.id,complaintDate:t.complaintDate||"",machineName:t.machineName||"",complaintDescription:t.complaintDescription||"",priority:t.priority||"Low",complaintStatus:a,actionDate:t.actionDate||null,maintenanceRemarks:t.maintenanceRemarks||null,initialInspectionDate:t.initialInspectionDate||null,estimatedEndDate:t.estimatedEndDate||null,finalizationDate:t.finalizationDate||null,createdBy:t.createdBy||"",department:t.department||"",materialsUsed:t.materialsUsed||[],history:t.history||[],complaintId:t.complaintId||e.id,assignedTo:t.assignedTo||"Person A"}});m(s),console.log("[ComplaintsClientPage] complaintsData:",s),s.forEach(e=>{console.log(`[ComplaintsClientPage] complaint id: ${e.id}, history:`,e.history)})}catch(e){console.error("[ComplaintsClientPage] Error fetching complaints:",e)}};()=>{"/"===window.location.pathname&&j()},(0,c.useRouter)();let f=async e=>{try{(await (0,r.Rj)(e)).success&&m(a.filter(t=>t.id!==e))}catch(e){console.error("Error deleting complaint:",e)}};return(0,i.jsxs)("div",{className:"p-4 h-[80vh] overflow-y-auto",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[i.jsx("h2",{className:"text-xl font-semibold",children:"Complaints"}),t?i.jsx(o.z,{className:"bg-primary text-primary-foreground px-6 py-2 rounded shadow hover:bg-primary/90 transition text-lg font-bold",onClick:()=>y.push("/complaints/new"),"data-testid":"new-complaint-btn",children:"+ New Complaint"}):i.jsx("span",{className:"text-red-600 font-semibold",children:"User not authenticated"})]}),i.jsx("div",{className:"mt-4",children:i.jsx(I,{complaints:a,onEdit:e=>{y.push(`/complaints/edit/${e.id}`)},onDelete:e=>f(e.id),onHistory:e=>{u(e),x(!0)},currentUser:t})}),i.jsx(z,{open:p,onClose:()=>x(!1),complaint:h})]})}}};