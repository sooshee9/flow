"use strict";exports.id=248,exports.ids=[248],exports.modules={4248:(e,t,a)=>{a.d(t,{$:()=>w});var n=a(326),r=a(7577),l=a(4723),s=a(4064),i=a(2576),o=a(1664),d=a(1190),c=a(1223),m=a(4214);let u=r.createContext({}),x=({...e})=>n.jsx(u.Provider,{value:{name:e.name},children:n.jsx(l.Qr,{...e})}),p=()=>{let e=r.useContext(u),{getFieldState:t,formState:a}=(0,l.Gc)(),n=t(e.name,a);if(!e)throw Error("useFormField should be used within <FormField>");return{name:e.name,...n}};function h({children:e,className:t,form:a,...r}){return n.jsx(l.RV,{...a,children:n.jsx("form",{className:(0,c.cn)("space-y-6",t),autoComplete:"off",...r,children:e})})}function g({className:e,...t}){return n.jsx("div",{className:(0,c.cn)("mb-2 rounded-lg bg-gradient-to-r from-blue-50 via-pink-50 to-yellow-50 dark:from-zinc-800 dark:via-zinc-900 dark:to-zinc-800 p-3",e),...t})}function b({className:e,...t}){return n.jsx("label",{className:(0,c.cn)("block text-base font-semibold mb-1",e),...t})}function j({...e}){let{error:t,name:a}=p();return n.jsx(m.g7,{id:a,"aria-invalid":!!t,...e})}function k({className:e,...t}){let{error:a}=p(),r=a?String(a?.message):t.children;return r?n.jsx("div",{className:(0,c.cn)("text-xs text-red-600 mt-1",e),...t,children:r}):null}j.displayName="AppFormControl",k.displayName="AppFormMessage";var f=a(4690),v=a(4097),y=a(3682);a(76),a(445);let N=["Mechanical","Electrical","Production","Quality","Other"],z=i.z.object({complaintId:i.z.string(),complaintDate:i.z.string(),machineName:i.z.string().min(1,"Machine name is required"),complaintDescription:i.z.string().min(1,"Description is required"),priority:i.z.enum(["Low","Medium","High"]),complaintStatus:i.z.enum(["Open","In Progress","Closed","Pending Parts"]).default("Open"),actionDate:i.z.string().nullable().default(null),maintenanceRemarks:i.z.string().nullable().default(null),initialInspectionDate:i.z.string().nullable().default(null),estimatedEndDate:i.z.string().nullable().default(null),finalizationDate:i.z.string().nullable().default(null),createdBy:i.z.string().email("Valid email required"),department:i.z.string().min(1,"Department is required"),assignedTo:i.z.enum(["Person A","Person B","Person C","Person D"]).default("Person A"),materialsUsed:i.z.array(i.z.object({name:i.z.string().min(1,"Material name required"),quantity:i.z.string().min(1,"Quantity required"),remarks:i.z.string().optional()})).default([]),history:i.z.array(i.z.object({action:i.z.string(),user:i.z.string(),timestamp:i.z.string()})).default([])});function w({onSuccess:e,complaint:t}){let{currentUser:a,loading:i}=(0,f.a)(),{toast:c}=(0,v.p)(),[m,u]=(0,r.useState)(!1),[p,w]=(0,r.useState)(t?.materialsUsed||[{name:"",quantity:"",remarks:""}]),[D,I]=(0,r.useState)(t?.department||"Mechanical"),[C,F]=(0,r.useState)(t?.history||[]),[S,P]=(0,r.useState)(t?.complaintId||""),q=(0,l.cI)({resolver:(0,s.F)(z),defaultValues:{complaintId:t?.complaintId||"",complaintDate:t?.complaintDate||new Date().toISOString().split("T")[0],machineName:t?.machineName||"",complaintDescription:t?.complaintDescription||"",priority:t?.priority||"Low",complaintStatus:t?.complaintStatus||"Open",actionDate:t?.actionDate||null,maintenanceRemarks:t?.maintenanceRemarks||null,initialInspectionDate:t?.initialInspectionDate||null,estimatedEndDate:t?.estimatedEndDate||null,finalizationDate:t?.finalizationDate||null,createdBy:t?.createdBy||a?.email||"",department:t?.department||"",assignedTo:t?.assignedTo||"Person A",materialsUsed:t?.materialsUsed||[{name:"",quantity:"",remarks:""}],history:t?.history||[]}}),U=async n=>{if(console.group("[ComplaintForm] onSubmit Debug"),console.log("currentUser:",a),console.log("form data:",n),!a||!a.email||!/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(a.email)){c({title:"Error",description:"You must be logged in with a valid email to submit a complaint.",variant:"destructive"}),console.warn("Submission blocked: invalid or missing user/email",a),console.groupEnd();return}u(!0);try{let r;let l=new Date().toISOString(),s=a.email,i=[];(i=t?[...Array.isArray(t.history)?t.history:[],{action:"Updated",user:s,timestamp:l}]:[{action:"Created",user:s,timestamp:l}])&&0!==i.length||(i=[{action:"Created",user:s,timestamp:l}]);let o={...n,assignedTo:n.assignedTo,createdBy:s,department:n.department,materialsUsed:p,history:i};if(console.log("Submitting payload:",o),r=t?.id?await (0,y.Rw)(t.id,o):await (0,y.GH)(o),console.log("Submission result:",r),r.success)c({title:"Success",description:r.message}),q.reset(),e(),console.info("Complaint submitted successfully:",{payload:o,result:r,user:a,time:new Date().toISOString()});else{let e="object"==typeof r.error?JSON.stringify(r.error):r.error;c({title:"Error",description:e||r.message||"Submission failed",variant:"destructive"}),console.error("Backend error:",r.message,e)}}catch(e){console.error("Submission error:",e),c({title:"Error",description:e?.message||"An unexpected error occurred",variant:"destructive"})}finally{u(!1),console.groupEnd()}};return i?(console.log("[ComplaintForm] AuthContext loading, not rendering form."),n.jsx("div",{className:"mb-4 p-4 bg-blue-100 text-blue-800 rounded text-center font-semibold animate-pulse",children:"Checking login status..."})):null==a?(console.warn("[ComplaintForm] currentUser is null, blocking form."),n.jsx("div",{className:"mb-4 p-4 bg-red-100 text-red-800 rounded text-center font-semibold",children:"You must be logged in to submit a complaint."})):"viewer"===a.role?(console.warn("[ComplaintForm] currentUser.role is viewer, blocking form."),n.jsx("div",{className:"mb-4 p-4 bg-yellow-100 text-yellow-800 rounded text-center font-semibold",children:"You do not have permission to submit a complaint."})):n.jsx(h,{form:q,onSubmit:q.handleSubmit(U),children:(0,n.jsxs)("div",{className:"max-w-3xl mx-auto bg-white dark:bg-zinc-900 rounded-2xl shadow-lg p-8 border border-zinc-200 dark:border-zinc-800 mt-6",children:[n.jsx("h2",{className:"text-2xl font-bold text-primary mb-6 text-center tracking-tight",children:"Complaint Form"}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,n.jsxs)("div",{className:"md:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-6 bg-gradient-to-r from-blue-50 via-pink-50 to-yellow-50 dark:from-zinc-800 dark:via-zinc-900 dark:to-zinc-800 rounded-xl p-6 mb-4",children:[n.jsx(x,{control:q.control,name:"complaintId",render:({field:e})=>(0,n.jsxs)(g,{children:[n.jsx(b,{htmlFor:e.name,className:"text-blue-700 dark:text-blue-300",children:"Complaint ID"}),n.jsx(j,{children:n.jsx(d.I,{...e,id:e.name,name:e.name,readOnly:!0,className:"bg-blue-100 dark:bg-zinc-800 font-semibold text-blue-900 dark:text-blue-200"})}),n.jsx(k,{})]})}),n.jsx(x,{control:q.control,name:"complaintDate",render:({field:e})=>(0,n.jsxs)(g,{children:[n.jsx(b,{htmlFor:e.name,className:"text-pink-700 dark:text-pink-300",children:"Complaint Date"}),n.jsx(j,{children:n.jsx(d.I,{type:"date",...e,id:e.name,name:e.name,className:"bg-pink-100 dark:bg-zinc-800 text-pink-900 dark:text-pink-200"})}),n.jsx(k,{})]})}),n.jsx(x,{control:q.control,name:"machineName",render:({field:e})=>(0,n.jsxs)(g,{children:[n.jsx(b,{htmlFor:e.name,className:"text-yellow-700 dark:text-yellow-300",children:"Machine Name"}),n.jsx(j,{children:n.jsx(d.I,{...e,id:e.name,name:e.name,className:"bg-yellow-100 dark:bg-zinc-800 text-yellow-900 dark:text-yellow-200"})}),n.jsx(k,{})]})}),n.jsx(x,{control:q.control,name:"complaintDescription",render:({field:e})=>(0,n.jsxs)(g,{className:"md:col-span-2",children:[n.jsx(b,{htmlFor:e.name,className:"text-purple-700 dark:text-purple-300",children:"Description"}),n.jsx(j,{children:n.jsx(d.I,{...e,id:e.name,name:e.name,className:"bg-purple-100 dark:bg-zinc-800 text-purple-900 dark:text-purple-200"})}),n.jsx(k,{})]})})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[n.jsx(x,{control:q.control,name:"priority",render:({field:e})=>(0,n.jsxs)(g,{children:[n.jsx(b,{htmlFor:e.name,className:"text-red-700 dark:text-red-300",children:"Priority"}),n.jsx(j,{children:(0,n.jsxs)("select",{...e,id:e.name,name:e.name,className:"w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-400 bg-white text-black",children:[n.jsx("option",{value:"Low",children:"Low"}),n.jsx("option",{value:"Medium",children:"Medium"}),n.jsx("option",{value:"High",children:"High"})]})}),n.jsx(k,{})]})}),n.jsx(x,{control:q.control,name:"complaintStatus",render:({field:e})=>(0,n.jsxs)(g,{children:[n.jsx(b,{htmlFor:e.name,className:"text-green-700 dark:text-green-300",children:"Status"}),n.jsx(j,{children:(0,n.jsxs)("select",{...e,id:e.name,name:e.name,className:"w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-green-400 bg-white text-black",required:!0,children:[n.jsx("option",{value:"Open",children:"Open"}),n.jsx("option",{value:"In Progress",children:"In Progress"}),n.jsx("option",{value:"Closed",children:"Closed"}),n.jsx("option",{value:"Pending Parts",children:"Pending Parts"}),n.jsx("option",{value:"Pending",children:"Pending"}),n.jsx("option",{value:"Completed",children:"Completed"})]})}),n.jsx(k,{})]})}),n.jsx(x,{control:q.control,name:"actionDate",render:({field:e})=>(0,n.jsxs)(g,{children:[(0,n.jsxs)(b,{htmlFor:e.name,children:["Action Date ",n.jsx("span",{className:"text-xs text-gray-500",children:"(Date when action was/will be taken)"})]}),n.jsx(j,{children:n.jsx(d.I,{type:"date",...e,id:e.name,name:e.name,value:e.value||""})}),n.jsx(k,{})]})}),n.jsx(x,{control:q.control,name:"maintenanceRemarks",render:({field:e})=>(0,n.jsxs)(g,{children:[n.jsx(b,{htmlFor:e.name,children:"Maintenance Remarks"}),n.jsx(j,{children:n.jsx(d.I,{...e,id:e.name,name:e.name,value:e.value||""})}),n.jsx(k,{})]})}),n.jsx(x,{control:q.control,name:"initialInspectionDate",render:({field:e})=>(0,n.jsxs)(g,{children:[(0,n.jsxs)(b,{htmlFor:e.name,children:["Initial Inspection Date ",n.jsx("span",{className:"text-xs text-gray-500",children:"(First check/inspection date)"})]}),n.jsx(j,{children:n.jsx(d.I,{type:"date",...e,id:e.name,name:e.name,value:e.value||""})}),n.jsx(k,{})]})}),n.jsx(x,{control:q.control,name:"estimatedEndDate",render:({field:e})=>(0,n.jsxs)(g,{children:[(0,n.jsxs)(b,{htmlFor:e.name,children:["Estimated End Date ",n.jsx("span",{className:"text-xs text-gray-500",children:"(Expected completion date)"})]}),n.jsx(j,{children:n.jsx(d.I,{type:"date",...e,id:e.name,name:e.name,value:e.value||""})}),n.jsx(k,{})]})}),n.jsx(x,{control:q.control,name:"finalizationDate",render:({field:e})=>(0,n.jsxs)(g,{children:[(0,n.jsxs)(b,{htmlFor:e.name,children:["Finalization Date ",n.jsx("span",{className:"text-xs text-gray-500",children:"(Date when complaint was fully resolved)"})]}),n.jsx(j,{children:n.jsx(d.I,{type:"date",...e,id:e.name,name:e.name,value:e.value||""})}),n.jsx(k,{})]})}),n.jsx(x,{control:q.control,name:"createdBy",render:({field:e})=>(0,n.jsxs)(g,{children:[n.jsx(b,{htmlFor:e.name,children:"Created By (Email)"}),n.jsx(j,{children:n.jsx(d.I,{type:"email",...e,id:e.name,name:e.name,value:e.value||"",readOnly:!0})}),n.jsx(k,{})]})}),n.jsx(x,{control:q.control,name:"department",render:({field:e})=>(0,n.jsxs)(g,{children:[n.jsx(b,{htmlFor:e.name,className:"text-indigo-700 dark:text-indigo-300",children:"Concerned Department"}),n.jsx(j,{children:n.jsx("select",{...e,id:e.name,name:e.name,className:"w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-400 bg-white text-black",required:!0,children:N.map(e=>n.jsx("option",{value:e,children:e},e))})}),n.jsx(k,{})]})}),n.jsx(x,{control:q.control,name:"assignedTo",render:({field:e})=>(0,n.jsxs)(g,{children:[n.jsx(b,{className:"text-blue-700 dark:text-blue-300",children:"Assigned To"}),n.jsx(j,{children:(0,n.jsxs)("select",{...e,className:"w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-400 bg-white text-black",children:[n.jsx("option",{value:"Person A",children:"Person A"}),n.jsx("option",{value:"Person B",children:"Person B"}),n.jsx("option",{value:"Person C",children:"Person C"}),n.jsx("option",{value:"Person D",children:"Person D"})]})}),n.jsx(k,{})]})})]}),(0,n.jsxs)("div",{className:"md:col-span-2 mt-6",children:[n.jsx("h3",{className:"text-lg font-semibold text-pink-700 dark:text-pink-300 mb-2",children:"Materials Used"}),(0,n.jsxs)("div",{className:"space-y-2",children:[p.map((e,t)=>(0,n.jsxs)("div",{className:"flex gap-2 mb-2 items-center",children:[(0,n.jsxs)("div",{className:"flex flex-col w-1/3",children:[n.jsx("label",{htmlFor:`material-name-${t}`,className:"block text-xs font-semibold mb-1",children:"Material Name"}),n.jsx(d.I,{id:`material-name-${t}`,name:`materialsUsed.${t}.name`,placeholder:"Material Name",value:e.name,onChange:e=>{let a=[...p];a[t].name=e.target.value,w(a),q.setValue("materialsUsed",a)},className:"bg-blue-50 dark:bg-zinc-800",required:!0})]}),(0,n.jsxs)("div",{className:"flex flex-col w-1/4",children:[n.jsx("label",{htmlFor:`material-quantity-${t}`,className:"block text-xs font-semibold mb-1",children:"Quantity"}),n.jsx(d.I,{id:`material-quantity-${t}`,name:`materialsUsed.${t}.quantity`,placeholder:"Quantity",value:e.quantity,onChange:e=>{let a=[...p];a[t].quantity=e.target.value,w(a),q.setValue("materialsUsed",a)},className:"bg-yellow-50 dark:bg-zinc-800",required:!0})]}),(0,n.jsxs)("div",{className:"flex flex-col w-1/3",children:[n.jsx("label",{htmlFor:`material-remarks-${t}`,className:"block text-xs font-semibold mb-1",children:"Remarks"}),n.jsx(d.I,{id:`material-remarks-${t}`,name:`materialsUsed.${t}.remarks`,placeholder:"Remarks",value:e.remarks||"",onChange:e=>{let a=[...p];a[t].remarks=e.target.value,w(a),q.setValue("materialsUsed",a)},className:"bg-pink-50 dark:bg-zinc-800"})]}),n.jsx(o.z,{type:"button",variant:"destructive",size:"sm",onClick:()=>{let e=p.filter((e,a)=>a!==t);w(e),q.setValue("materialsUsed",e)},disabled:1===p.length,children:"Remove"})]},t)),n.jsx(o.z,{type:"button",variant:"secondary",size:"sm",className:"bg-gradient-to-r from-blue-200 via-pink-200 to-yellow-200 dark:from-zinc-700 dark:via-zinc-800 dark:to-zinc-700 text-blue-900 dark:text-blue-200",onClick:()=>{let e=[...p,{name:"",quantity:"",remarks:""}];w(e),q.setValue("materialsUsed",e)},children:"+ Add Material"})]})]}),(0,n.jsxs)("div",{className:"md:col-span-2 mt-6",children:[n.jsx("h3",{className:"text-lg font-semibold text-green-700 dark:text-green-300 mb-2",children:"Complaint History"}),n.jsx("div",{className:"bg-gradient-to-r from-green-50 via-blue-50 to-pink-50 dark:from-zinc-800 dark:via-zinc-900 dark:to-zinc-800 rounded p-3 max-h-40 overflow-y-auto text-xs",children:0===C.length?n.jsx("div",{className:"text-gray-500",children:"No history yet."}):C.map((e,t)=>(0,n.jsxs)("div",{className:"mb-1",children:[n.jsx("span",{className:"font-semibold text-green-700 dark:text-green-300",children:e.action})," by ",n.jsx("span",{className:"text-blue-700 dark:text-blue-300",children:e.user})," on ",n.jsx("span",{className:"text-pink-700 dark:text-pink-300",children:new Date(e.timestamp).toLocaleString()})]},t))})]}),n.jsx("div",{className:"md:col-span-2 mt-8",children:n.jsx(o.z,{type:"submit",disabled:m||!a?.email,className:"w-full text-lg font-bold bg-gradient-to-r from-blue-500 via-pink-500 to-yellow-500 text-white shadow-lg hover:from-blue-600 hover:via-pink-600 hover:to-yellow-600",children:m?"Submitting...":t?"Update":"Submit"})})]})]})},a?.email||"nouser")}},1190:(e,t,a)=>{a.d(t,{I:()=>s});var n=a(326),r=a(7577),l=a(1223);let s=r.forwardRef(({className:e,...t},a)=>n.jsx("input",{ref:a,className:(0,l.cn)("block w-full rounded-lg border border-blue-200 dark:border-zinc-700 bg-white dark:bg-zinc-900 px-4 py-2 text-base text-blue-900 dark:text-blue-200 placeholder:text-blue-400 dark:placeholder:text-zinc-500 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-400 transition-all duration-150 shadow-sm","hover:border-pink-400 dark:hover:border-pink-400",e),...t}));s.displayName="Input"}};