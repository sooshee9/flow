(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[626],{219:function(e,t,a){Promise.resolve().then(a.bind(a,8991))},8991:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return g}});var i=a(7437),n=a(2265),s=a(9376),o=a(3301),r=a(5978),l=a(6410),c=a(3340),d=a(279),u=a(2381),m=a(2926),p=a(738);function g(){let[e,t]=(0,n.useState)("sooshee9@gmail.com"),[a,g]=(0,n.useState)("123456789"),[h,f]=(0,n.useState)(!1),[b,x]=(0,n.useState)([]),[k,w]=(0,n.useState)(null),{toast:y}=(0,c.p)(),N=(0,s.useRouter)(),v=async t=>{t.preventDefault(),f(!0),y({title:"Login Attempt",description:"Attempting to log in..."}),console.log("[LoginPage] Login attempt for",e);try{let t=(await (0,o.e5)(l.I,e,a)).user.uid;console.log("[LoginPage] Firebase login success, uid:",t);let i=(0,r.JU)(l.db,"users",t),n=await (0,r.QT)(i),s="user";if(n.exists()){let e=n.data();console.log("[LoginPage] Firestore userDoc:",e),s="admin"===e.role?"admin":"user"}else console.warn("[LoginPage] User profile not found in Firestore, defaulting to user role."),y({title:"Warning",description:"User profile not found. Defaulting to user role.",variant:"default"});w(s);let c=(0,r.hJ)(l.db,"complaints"),d="admin"===s?c:(0,r.IO)(c,(0,r.ar)("createdBy","==",e)),u=(await (0,r.PL)(d)).docs.map(e=>{let t=e.data(),a=["Open","In Progress","Closed","Pending Parts"].includes(t.complaintStatus)?t.complaintStatus:"Open";return{complaintId:t.complaintId||e.id,department:t.department||"",materialsUsed:t.materialsUsed||[],history:t.history||[],id:e.id,userId:t.userId||"",complaintDate:t.complaintDate||"",machineName:t.machineName||"",complaintDescription:t.complaintDescription||"",priority:t.priority||"Low",complaintStatus:a,actionDate:t.actionDate||null,maintenanceRemarks:t.maintenanceRemarks||null,initialInspectionDate:t.initialInspectionDate||null,estimatedEndDate:t.estimatedEndDate||null,finalizationDate:t.finalizationDate||null,createdBy:t.createdBy||"",assignedTo:t.assignedTo||"Person A"}});x(u),console.log("[LoginPage] Complaints fetched:",u),y({title:"Success",description:"Logged in as ".concat(s,". Found ").concat(u.length," complaints.")}),N.push("/")}catch(t){let e="Failed to log in. Please try again.";if(console.error("[LoginPage] Login error:",t),t instanceof p.ZR)switch(t.code){case"auth/invalid-credential":e="Invalid email or password.";break;case"auth/user-disabled":e="This account has been disabled.";break;case"auth/too-many-requests":e="Too many attempts. Please try again later.";break;case"auth/network-request-failed":e="Network error. Please check your connection.";break;case"permission-denied":e="Permission denied. Check Firestore rules or user data.";break;default:e="Error: ".concat(t.message)}y({title:"Error",description:e,variant:"destructive"})}finally{f(!1)}};return(0,i.jsxs)("div",{className:"container mx-auto p-4 max-w-md",children:[(0,i.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Login"}),(0,i.jsxs)("form",{onSubmit:v,className:"space-y-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium",children:"Email"}),(0,i.jsx)(d.I,{id:"email",type:"email",value:e,onChange:e=>t(e.target.value),placeholder:"Enter your email",required:!0})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium",children:"Password"}),(0,i.jsx)(d.I,{id:"password",type:"password",value:a,onChange:e=>g(e.target.value),placeholder:"Enter your password",required:!0})]}),(0,i.jsx)(u.z,{type:"submit",disabled:h,className:"w-full",children:h?"Logging in...":"Login"})]}),(0,i.jsxs)("div",{className:"mt-8",children:[(0,i.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Complaints"}),b.length>0?(0,i.jsx)(m.m,{initialComplaints:b}):(0,i.jsx)("p",{children:'No complaints found. Click "New Complaint" after logging in to create one.'}),k&&(0,i.jsxs)("p",{className:"mt-4",children:["Logged in as: ",k]})]}),(0,i.jsx)(u.z,{className:"mt-4",onClick:()=>y({title:"Test",description:"This is a test toast"}),children:"Test Toast"})]})}},279:function(e,t,a){"use strict";a.d(t,{I:function(){return o}});var i=a(7437),n=a(2265),s=a(3448);let o=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,i.jsx)("input",{ref:t,className:(0,s.cn)("block w-full rounded-lg border border-blue-200 dark:border-zinc-700 bg-white dark:bg-zinc-900 px-4 py-2 text-base text-blue-900 dark:text-blue-200 placeholder:text-blue-400 dark:placeholder:text-zinc-500 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-400 transition-all duration-150 shadow-sm","hover:border-pink-400 dark:hover:border-pink-400",a),...n})});o.displayName="Input"}},function(e){e.O(0,[358,728,812,775,926,971,117,744],function(){return e(e.s=219)}),_N_E=e.O()}]);