"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[926],{2926:function(e,t,a){a.d(t,{m:function(){return I}});var n=a(7437),i=a(2265),r=a(5978),s=a(6410),o=a(2381),l=a(3671),d=a(1245),c=a(9376),m=a(3448);let u=i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,n.jsx)("div",{className:"relative w-full overflow-auto",children:(0,n.jsx)("table",{ref:t,className:(0,m.cn)("w-full caption-bottom text-sm",a),...i})})});u.displayName="Table";let p=i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,n.jsx)("thead",{ref:t,className:(0,m.cn)("[&_tr]:border-b",a),...i})});p.displayName="TableHeader";let x=i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,n.jsx)("tbody",{ref:t,className:(0,m.cn)("[&_tr:last-child]:border-0",a),...i})});x.displayName="TableBody",i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,n.jsx)("tfoot",{ref:t,className:(0,m.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...i})}).displayName="TableFooter";let h=i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,n.jsx)("tr",{ref:t,className:(0,m.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",a),...i})});h.displayName="TableRow";let f=i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,n.jsx)("th",{ref:t,className:(0,m.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",a),...i})});f.displayName="TableHead";let g=i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,n.jsx)("td",{ref:t,className:(0,m.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",a),...i})});g.displayName="TableCell",i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,n.jsx)("caption",{ref:t,className:(0,m.cn)("mt-4 text-sm text-muted-foreground",a),...i})}).displayName="TableCaption";var w=a(8930),b=a(5868),y=a(2208),j=a(6424),v=a(9972);let N=v.zt,D=v.fC,C=v.xz,k=i.forwardRef((e,t)=>{let{className:a,sideOffset:i=4,...r}=e;return(0,n.jsx)(v.VY,{ref:t,sideOffset:i,className:(0,m.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...r})});function A(e){let{complaints:t,onEdit:a,onDelete:r,onHistory:s,currentUser:l}=e,d=(0,i.useMemo)(()=>{if(!l)return{canEditAny:!1,canDeleteAny:!1,isEffectivelyViewer:!0};let e=l.role,t=!1,a=!1;return"admin"===e?(t=!0,a=!0):"special_editor_priority"===e||"updater"===e?(t=!0,a=!1):"creator"===e&&(t=!0,a=!1),{canEditAny:t,canDeleteAny:a}},[l]);return l?t&&0!==t.length?(0,n.jsx)(N,{children:(0,n.jsx)("div",{className:"rounded-lg border shadow-sm bg-white",children:(0,n.jsxs)(u,{className:"w-full",children:[(0,n.jsxs)("colgroup",{children:[(0,n.jsx)("col",{style:{width:"60px"}}),(0,n.jsx)("col",{style:{width:"100px"}}),(0,n.jsx)("col",{style:{width:"120px"}}),(0,n.jsx)("col",{style:{width:"140px"}}),(0,n.jsx)("col",{style:{minWidth:"250px"}}),(0,n.jsx)("col",{style:{width:"90px"}}),(0,n.jsx)("col",{style:{width:"110px"}}),(0,n.jsx)("col",{style:{width:"200px"}}),(0,n.jsx)("col",{style:{width:"160px"}}),(0,n.jsx)("col",{style:{width:"120px"}}),(0,n.jsx)("col",{style:{minWidth:"200px"}}),(0,n.jsx)("col",{style:{width:"90px"}}),(0,n.jsx)("col",{style:{width:"120px"}}),(0,n.jsx)("col",{style:{width:"120px"}}),(0,n.jsx)("col",{style:{width:"120px"}}),(0,n.jsx)("col",{style:{width:"120px"}}),(0,n.jsx)("col",{style:{width:"80px"}}),(0,n.jsx)("col",{style:{width:"120px"}})]}),(0,n.jsx)(p,{children:(0,n.jsxs)(h,{children:[(0,n.jsx)(f,{className:"w-[60px] pl-[20px]",children:"Sl No"}),(0,n.jsx)(f,{className:"w-[100px]",children:"Complaint ID"}),(0,n.jsx)(f,{className:"w-[120px]",children:"C. Date"}),(0,n.jsx)(f,{className:"w-[140px]",children:"Machine Name"}),(0,n.jsx)(f,{className:"min-w-[250px]",children:"Description"}),(0,n.jsx)(f,{className:"w-[90px]",children:"Priority"}),(0,n.jsx)(f,{className:"w-[110px]",children:"Status"}),(0,n.jsx)(f,{className:"w-[200px]",children:"Created By (Email)"}),(0,n.jsx)(f,{className:"w-[160px]",children:"Concerned Department"}),(0,n.jsx)(f,{className:"w-[120px]",children:"A. Date"}),(0,n.jsx)(f,{className:"min-w-[200px]",children:"Remarks"}),(0,n.jsx)(f,{className:"w-[90px]",children:"Assigned To"}),(0,n.jsx)(f,{className:"w-[120px]",children:"In-I. Date"}),(0,n.jsx)(f,{className:"w-[120px]",children:"In-E. Date"}),(0,n.jsx)(f,{className:"w-[120px]",children:"F. Date"}),(0,n.jsx)(f,{className:"text-center w-[120px]",children:"History"}),(0,n.jsx)(f,{className:"text-center w-[80px]",children:"Delete"}),(0,n.jsx)(f,{className:"text-right w-[120px]",children:"Actions"})]})}),(0,n.jsx)(x,{children:t.map((e,t)=>{let i=!1;if(l){let e=l.role;"admin"===e?i=!0:"creator"===e?i=!1:"updater"===e?i=!0:"special_editor_priority"===e&&(i=!0)}return(0,n.jsxs)(h,{className:"align-middle text-sm whitespace-nowrap",children:[(0,n.jsx)(g,{className:"font-mono text-xs text-muted-foreground py-3 pl-[20px]",children:String(t+1).padStart(2,"0")}),(0,n.jsx)(g,{className:"font-mono text-xs font-bold py-3",children:e.complaintId&&""!==e.complaintId.trim()&&void 0!==e.complaintId?e.complaintId:e.id?e.id.slice(-2).padStart(2,"0"):"N/A"}),(0,n.jsx)(g,{children:e.complaintDate&&!isNaN(new Date(e.complaintDate).getTime())?(0,j.WU)(new Date(e.complaintDate),"dd-MM-yy"):"N/A"}),(0,n.jsx)(g,{className:"font-medium",children:e.machineName}),(0,n.jsx)(g,{children:(0,n.jsxs)(D,{children:[(0,n.jsx)(C,{asChild:!0,children:(0,n.jsx)("p",{className:"truncate max-w-[250px] hover:underline cursor-pointer",children:e.complaintDescription})}),(0,n.jsx)(k,{side:"top",align:"start",className:"max-w-xs bg-popover text-popover-foreground p-2 rounded shadow-lg border",children:(0,n.jsx)("p",{className:"text-sm",children:e.complaintDescription})})]})}),(0,n.jsx)(g,{children:(0,n.jsx)("span",{className:"High"===e.priority?"priority-badge-high":"Medium"===e.priority?"priority-badge-medium":"priority-badge-low",children:e.priority})}),(0,n.jsx)(g,{children:(0,n.jsx)("span",{className:"Open"===e.complaintStatus?"status-badge-open":"Closed"===e.complaintStatus?"status-badge-closed":"status-badge-inprogress",children:e.complaintStatus})}),(0,n.jsx)(g,{className:"font-mono text-xs",children:e.createdBy||"N/A"}),(0,n.jsx)(g,{style:{minWidth:180,fontWeight:600},children:e.department&&""!==e.department?e.department:"N/A"}),(0,n.jsx)(g,{children:e.actionDate&&!isNaN(new Date(e.actionDate).getTime())?(0,j.WU)(new Date(e.actionDate),"dd-MM-yy"):"N/A"}),(0,n.jsx)(g,{children:e.maintenanceRemarks||"N/A"}),(0,n.jsx)(g,{children:(0,n.jsxs)("select",{value:e.assignedTo||"Person A",onChange:e=>{},style:{width:"100%",padding:4,borderRadius:4,border:"1px solid #1976d2",color:"#1976d2",background:"#e3f0ff",fontWeight:600,minWidth:160},children:[(0,n.jsx)("option",{value:"Person A",children:"Person A"}),(0,n.jsx)("option",{value:"Person B",children:"Person B"}),(0,n.jsx)("option",{value:"Person C",children:"Person C"}),(0,n.jsx)("option",{value:"Person D",children:"Person D"})]})}),(0,n.jsx)(g,{children:e.initialInspectionDate&&!isNaN(new Date(e.initialInspectionDate).getTime())?(0,j.WU)(new Date(e.initialInspectionDate),"dd-MM-yy"):"N/A"}),(0,n.jsx)(g,{children:e.estimatedEndDate&&!isNaN(new Date(e.estimatedEndDate).getTime())?(0,j.WU)(new Date(e.estimatedEndDate),"dd-MM-yy"):"N/A"}),(0,n.jsx)(g,{children:e.finalizationDate&&!isNaN(new Date(e.finalizationDate).getTime())?(0,j.WU)(new Date(e.finalizationDate),"dd-MM-yy"):"N/A"}),(0,n.jsx)(g,{className:"text-center",children:(0,n.jsx)(o.z,{variant:"outline",size:"sm",onClick:()=>s(e),"aria-label":"Complaint History",className:"text-blue-600 border-blue-400 hover:bg-blue-50",children:"History"})}),(0,n.jsx)(g,{className:"text-center",children:d.canDeleteAny&&(0,n.jsx)(o.z,{variant:"ghost",size:"sm",onClick:()=>r(e),className:"text-destructive hover:text-destructive/80","aria-label":"Delete Complaint",children:(0,n.jsx)(w.Z,{className:"h-4 w-4"})})}),(0,n.jsx)(g,{className:"text-right",children:(0,n.jsx)(o.z,{variant:"ghost",size:"sm",onClick:()=>a(e),"aria-label":i&&d.canEditAny?"Edit Complaint":"View Complaint",children:i&&d.canEditAny?(0,n.jsx)(b.Z,{className:"h-4 w-4"}):(0,n.jsx)(y.Z,{className:"h-4 w-4"})})})]},e.id)})})]})})}):(0,n.jsx)("p",{className:"text-center text-muted-foreground py-8",children:"No complaints found."}):(0,n.jsx)("p",{className:"text-center text-muted-foreground py-8",children:"Please log in to view complaints."})}k.displayName=v.VY.displayName;let S=e=>{let{open:t,onClose:a,complaint:i}=e;return t?i?(0,n.jsx)("div",{style:{zIndex:9999,position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"rgba(0,0,0,0.3)",display:t?"flex":"none",alignItems:"center",justifyContent:"center"},children:(0,n.jsxs)("div",{style:{background:"linear-gradient(135deg, #e3f0ff 0%, #90caf9 100%)",borderRadius:12,minWidth:400,minHeight:200,padding:28,boxShadow:"0 0 24px #0004",position:"relative",border:"2px solid #1976d2"},children:[(0,n.jsx)("button",{onClick:a,style:{position:"absolute",top:8,right:12,fontWeight:700,fontSize:22,background:"#1976d2",color:"white",border:"none",borderRadius:"50%",width:32,height:32,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"background 0.2s",boxShadow:"0 2px 8px #1976d233"},title:"Close",children:"\xd7"}),(0,n.jsx)("h2",{style:{fontWeight:700,fontSize:20,marginBottom:12,color:"#1976d2"},children:"Complaint History"}),Array.isArray(i.history)&&i.history.length>0?(0,n.jsx)("ul",{style:{margin:0,padding:0,listStyle:"none"},children:i.history.map((e,t)=>{let a="";return a="Created"===e.action?"Created by ":"Updated"===e.action?"Updated by ":"".concat(e.action," by "),(0,n.jsxs)("li",{style:{marginBottom:8,display:"flex",alignItems:"center",gap:12},children:[(0,n.jsx)("span",{style:{color:"#333",fontWeight:500},children:a}),(0,n.jsx)("a",{href:"mailto:".concat(e.user),style:{color:"#1976d2",textDecoration:"underline",fontWeight:500},children:e.user}),(0,n.jsx)("span",{style:{color:"#c2185b",fontWeight:600},children:new Date(e.timestamp).toLocaleString("en-GB",{day:"numeric",month:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",second:"2-digit",hour12:!0})})]},t)})}):(0,n.jsxs)("div",{style:{color:"red",fontWeight:600},children:["No history available.",(0,n.jsx)("br",{})]})]})}):(0,n.jsxs)("div",{style:{padding:24,color:"red",fontWeight:600},children:["No complaint selected.",(0,n.jsx)("br",{})]}):null};function I(e){var t,a;let{initialComplaints:m=[]}=e,{currentUser:u}=(0,d.a)(),[p,x]=(0,i.useState)(m),[h,f]=(0,i.useState)(!1),[g,w]=(0,i.useState)(null),b=(0,c.useRouter)(),y=(t="refresh",(0,i.useMemo)(()=>new URLSearchParams(window.location.search).get(t),[window.location.search])),j=async()=>{if(console.log("[ComplaintsClientPage] fetchComplaints: currentUser",u),u)try{let e;e="admin"===u.role||"maintenance"===u.role?(0,r.hJ)(s.db,"complaints"):(0,r.IO)((0,r.hJ)(s.db,"complaints"),(0,r.ar)("createdBy","==",u.email));let t=await (0,r.PL)(e),a=["Open","In Progress","Closed","Pending Parts"],n=t.docs.map(e=>{let t=e.data(),n=a.includes(t.complaintStatus)?t.complaintStatus:"Open";return{id:e.id,complaintDate:t.complaintDate||"",machineName:t.machineName||"",complaintDescription:t.complaintDescription||"",priority:t.priority||"Low",complaintStatus:n,actionDate:t.actionDate||null,maintenanceRemarks:t.maintenanceRemarks||null,initialInspectionDate:t.initialInspectionDate||null,estimatedEndDate:t.estimatedEndDate||null,finalizationDate:t.finalizationDate||null,createdBy:t.createdBy||"",department:t.department||"",materialsUsed:t.materialsUsed||[],history:t.history||[],complaintId:t.complaintId||e.id,assignedTo:t.assignedTo||"Person A"}});x(n),console.log("[ComplaintsClientPage] complaintsData:",n),n.forEach(e=>{console.log("[ComplaintsClientPage] complaint id: ".concat(e.id,", history:"),e.history)})}catch(e){console.error("[ComplaintsClientPage] Error fetching complaints:",e)}};(0,i.useEffect)(()=>{j()},[u]),(0,i.useEffect)(()=>{if("1"===y&&(j(),window.history.replaceState)){let e=new URL(window.location.href);e.searchParams.delete("refresh"),window.history.replaceState({},document.title,e.pathname+e.search)}},[y]),a=()=>{"/"===window.location.pathname&&j()},(0,c.useRouter)(),(0,i.useEffect)(()=>{let e=()=>{"/"===window.location.pathname&&a()};return window.addEventListener("popstate",e),()=>window.removeEventListener("popstate",e)},[a]);let v=async e=>{try{(await (0,l.Rj)(e)).success&&x(p.filter(t=>t.id!==e))}catch(e){console.error("Error deleting complaint:",e)}};return(0,n.jsxs)("div",{className:"p-4 h-[80vh] overflow-y-auto",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold",children:"Complaints"}),u?(0,n.jsx)(o.z,{className:"bg-primary text-primary-foreground px-6 py-2 rounded shadow hover:bg-primary/90 transition text-lg font-bold",onClick:()=>b.push("/complaints/new"),"data-testid":"new-complaint-btn",children:"+ New Complaint"}):(0,n.jsx)("span",{className:"text-red-600 font-semibold",children:"User not authenticated"})]}),(0,n.jsx)("div",{className:"mt-4",children:(0,n.jsx)(A,{complaints:p,onEdit:e=>{b.push("/complaints/edit/".concat(e.id))},onDelete:e=>v(e.id),onHistory:e=>{w(e),f(!0)},currentUser:u})}),(0,n.jsx)(S,{open:h,onClose:()=>f(!1),complaint:g})]})}},2381:function(e,t,a){a.d(t,{z:function(){return r}});var n=a(7437),i=a(3448);let r=a(2265).forwardRef((e,t)=>{let{className:a,variant:r="primary",size:s="md",...o}=e,l="";switch(r){case"primary":l="bg-gradient-to-r from-blue-500 via-pink-500 to-yellow-500 text-white shadow-lg rounded-lg hover:from-blue-600 hover:via-pink-600 hover:to-yellow-600";break;case"secondary":l="bg-gradient-to-r from-blue-200 via-pink-200 to-yellow-200 text-blue-900 dark:text-blue-200 rounded-lg hover:from-blue-300 hover:via-pink-300 hover:to-yellow-300";break;case"destructive":l="bg-red-600 text-white rounded-lg hover:bg-red-700";break;case"ghost":l="bg-transparent text-primary hover:bg-blue-50 dark:hover:bg-zinc-800 rounded-lg";break;case"outline":l="border border-blue-400 text-blue-700 dark:text-blue-300 bg-white dark:bg-zinc-900 rounded-lg hover:bg-blue-50 dark:hover:bg-zinc-800";break;default:l=""}let d="";switch(s){case"sm":d="px-3 py-1.5 text-sm";break;case"lg":d="px-6 py-3 text-lg";break;default:d="px-4 py-2 text-base"}return(0,n.jsx)("button",{ref:t,className:(0,i.cn)("inline-flex items-center justify-center font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none",l,d,a),...o})});r.displayName="Button"},1245:function(e,t,a){a.d(t,{AuthProvider:function(){return c},a:function(){return m}});var n=a(7437),i=a(2265),r=a(6410),s=a(3301),o=a(5978),l=a(3340);let d=(0,i.createContext)({currentUser:null,loading:!0,logout:async()=>{}});function c(e){let{children:t}=e,[a,c]=(0,i.useState)(null),[m,u]=(0,i.useState)(!0),{toast:p}=(0,l.p)();(0,i.useEffect)(()=>{let e=(0,s.Aj)(r.I,async e=>{if(console.log("[AuthContext] onAuthStateChanged:",e),e){var t,a;let n=(0,o.JU)(r.db,"users",e.uid),i=await (0,o.QT)(n),s=i.exists()?i.data():null;console.log("[AuthContext] Firestore userDoc:",s),c({uid:e.uid,email:e.email||(null==s?void 0:s.email)||null,role:null!==(t=null==s?void 0:s.role)&&void 0!==t?t:"viewer"}),console.log("[AuthContext] setCurrentUser:",{uid:e.uid,email:e.email||(null==s?void 0:s.email)||null,role:null!==(a=null==s?void 0:s.role)&&void 0!==a?a:"viewer"})}else c(null),console.log("[AuthContext] setCurrentUser: null");u(!1),console.log("[AuthContext] setLoading: false")});return()=>e()},[]);let x=async()=>{try{await (0,s.w7)(r.I),c(null),p({title:"Success",description:"Logged out successfully."})}catch(e){throw console.error("Logout error:",e),p({title:"Error",description:"Failed to log out.",variant:"destructive"}),e}};return(0,n.jsx)(d.Provider,{value:{currentUser:a,loading:m,logout:x},children:t})}function m(){return(0,i.useContext)(d)}},3340:function(e,t,a){a.d(t,{p:function(){return r}});var n=a(2265);(0,a(535).j)("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}});let i=0;function r(){let[e,t]=(0,n.useState)([]);return{toast:(0,n.useCallback)(e=>{let{variant:a,title:n,description:r,action:s,...o}=e,l=(i++).toString();return t(e=>[...e,{id:l,variant:a,title:n,description:r,action:s,...o}]),l},[]),dismiss:(0,n.useCallback)(e=>{t(t=>t.filter(t=>t.id!==e))},[]),update:(0,n.useCallback)((e,a)=>{let{variant:n,title:i,description:r,action:s,...o}=a;t(t=>t.map(t=>t.id===e?{...t,variant:n,title:i,description:r,action:s,...o}:t))},[]),toasts:e}}},3671:function(e,t,a){a.d(t,{GH:function(){return r},Rj:function(){return i},Rw:function(){return s}}),a(3079);var n=a(2119),i=(0,n.$)("998298903baf9762d143374f7ecff409772b57f2"),r=(0,n.$)("9d39176c87d5a55a2a801870066abbb60034d1e9"),s=(0,n.$)("636e37b96d51317ae5b1270212bc499e1fddb28b")},6410:function(e,t,a){a.d(t,{I:function(){return l},db:function(){return d}});var n=a(738),i=a(3301),r=a(5978),s=a(62);let o=(0,n.ZF)({apiKey:"AIzaSyDBgH3vn2ec1FwRRkVIG5gAR9Jkno5VCR4",authDomain:"maintenance-flow-1c30c.firebaseapp.com",projectId:"maintenance-flow-1c30c",storageBucket:"maintenance-flow-1c30c.appspot.com",messagingSenderId:"116876204407",appId:"1:116876204407:web:7641e3dbb7a48cd69c6972"}),l=(0,i.v0)(o),d=(0,r.ad)(o);(0,s.cF)(o)},3448:function(e,t,a){a.d(t,{cn:function(){return r}});var n=a(1994),i=a(3335);function r(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,i.m6)((0,n.W)(t))}}}]);